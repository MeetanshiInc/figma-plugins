<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auto Color Palette & Gradient Generator </title> 
  <style>
    :root {
      --accent: #6C5CE7;
      --bg: #0f1115;
      --fg: #f3f4f6;
      --card: #171c25;
      --line: #2b3240;
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--fg);
      font: 13px/1.45 "Inter", system-ui, sans-serif;
      width: 100%;
      height: 100%;
      overflow-x: hidden;
      overflow-y: auto;
    }

    .layout {
      display: flex;
      flex-direction: column;
      height: 100%;
      box-sizing: border-box;
    }

    /* ðŸŒˆ Header */
    .hero {
      background: linear-gradient(135deg, #6C5CE7, #8b7bff, #00d4ff);
      background-size: 400% 400%;
      animation: gradientShift 5s linear infinite;
      padding: 14px;
      text-align: center;
      color: #fff;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 0 0 14px 14px;
      transition: background 0.5s ease;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .hero h1 {
      font-size: 15px;
      margin: 0;
      font-weight: 600;
    }

    .hero p {
      font-size: 11px;
      opacity: 0.85;
      margin-top: 4px;
    }

    .controls {
      background: var(--card);
      margin: 8px 10px;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--line);
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 8px 10px;
      align-items: center;
    }

    label { font-size: 12px; color: #a6b0c3; }

    input[type="text"], select, input[type="number"] {
      width: 100%;
      background: #10141c;
      border: 1px solid var(--line);
      color: var(--fg);
      border-radius: 6px;
      padding: 5px 8px;
      font-size: 12px;
    }

    input[type="color"] {
      width: 36px;
      height: 28px;
      border: none;
      background: transparent;
      cursor: pointer;
    }

    .btn {
      background: var(--accent);
      color: #fff;
      border: none;
      border-radius: 6px;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn.secondary { background: #1e2533; }

    .palette-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
      gap: 8px;
      margin: 6px 10px;
    }

    .swatch {
      border-radius: 8px;
      overflow: hidden;
      height: 80px;
      cursor: pointer;
      position: relative;
      transition: transform 0.15s ease;
    }

    .swatch:hover { transform: scale(1.05); }

    .swatch .info {
      position: absolute;
      bottom: 4px;
      left: 4px;
      right: 4px;
      background: rgba(0,0,0,0.45);
      font-size: 11px;
      color: #fff;
      padding: 2px 4px;
      border-radius: 4px;
      text-align: center;
    }

    .gradient-section {
      background: var(--card);
      margin: 10px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--line);
    }

    .gradient-preview {
      height: 60px;
      border-radius: 8px;
      margin-top: 6px;
      margin-bottom: 6px;
      border: 1px solid var(--line);
    }

    .gradient-code {
      font-family: monospace;
      background: #0f131b;
      color: #b4b9c6;
      font-size: 11px;
      padding: 6px;
      border-radius: 6px;
      overflow-x: auto;
      word-break: break-all;
    }

    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--card);
      padding: 8px 10px;
      border-top: 1px solid var(--line);
      border-radius: 8px 8px 0 0;
    }

    .toolbar .hint { font-size: 11px; color: #9ca3af; }

    .toast {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(15,20,30,0.85);
      color: white;
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 12px;
      border: 1px solid rgba(255,255,255,0.1);
      animation: fadeInOut 1.2s ease forwards;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, 6px); }
      15% { opacity: 1; transform: translate(-50%, 0); }
      85% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, 6px); }
    }
  </style>
</head>
<body>
  <div class="layout">
    <div class="hero" id="hero">
      <h1>Auto Color Palette & Gradient Generator</h1>
      <p>Live updates with your color âœ¨</p>
    </div>

    <div class="controls">
      <label>Seed</label>
      <div style="display:flex;gap:4px;align-items:center;">
        <input id="seed" type="text" value="#6C5CE7" />
        <input id="seedPick" type="color" value="#6C5CE7" />
      </div>
      <label>Harmony</label>
      <select id="mode">
        <option value="tints-shades">Tints & Shades</option>
        <option value="complementary">Complementary</option>
        <option value="analogous" selected>Analogous</option>
        <option value="triadic">Triadic</option>
        <option value="tetradic">Tetradic</option>
      </select>
      <label>Steps</label>
      <input id="steps" type="number" min="3" max="12" value="6" />
      <button class="btn" id="random">Random</button>
    </div>

    <div id="grid" class="palette-grid"></div>

    <!-- ðŸŽ¨ Gradient Generator -->
    <div class="gradient-section" id="gradientSection" style="display:none;">
      <div class="gradient-preview" id="gradientPreview"></div>
      <div class="gradient-code" id="gradientCode"></div>
      <button class="btn secondary" id="copyGradient">Copy CSS</button>
    </div>

    <div class="toolbar">
      <span class="hint">Click color to copy HEX</span>
      <div>
        <button class="btn secondary" id="createStyles">Styles</button>
        <button class="btn secondary" id="addSwatches">Swatches</button>
        <button class="btn secondary" id="close">Close</button>
      </div>
    </div>
  </div>

  <script>
    const $ = (s) => document.querySelector(s);
    const seed = $('#seed');
    const seedPick = $('#seedPick');
    const mode = $('#mode');
    const steps = $('#steps');
    const grid = $('#grid');
    const hero = $('#hero');
    const gradientSection = $('#gradientSection');
    const gradientPreview = $('#gradientPreview');
    const gradientCode = $('#gradientCode');
    let currentPalette = [];

    seedPick.addEventListener('input', () => {
      seed.value = seedPick.value;
      render(); // auto-update on color change
    });
    seed.addEventListener('input', () => {
      seedPick.value = seed.value;
      render();
    });
    mode.addEventListener('change', render);
    steps.addEventListener('input', render);

    $('#random').addEventListener('click', () => {
      seed.value = randomHex();
      seedPick.value = seed.value;
      render();
    });

    $('#createStyles').addEventListener('click', () =>
      parent.postMessage({ pluginMessage: { type: 'CREATE_STYLES', palette: currentPalette, prefix: 'Palette' } }, '*')
    );
    $('#addSwatches').addEventListener('click', () =>
      parent.postMessage({ pluginMessage: { type: 'CREATE_SWATCHES', palette: currentPalette, title: 'Palette Swatches' } }, '*')
    );
    $('#close').addEventListener('click', () =>
      parent.postMessage({ pluginMessage: { type: 'CLOSE' } }, '*')
    );
    $('#copyGradient').addEventListener('click', () => {
      navigator.clipboard.writeText(gradientCode.textContent);
      toast('Copied Gradient CSS');
    });

    function copyHex(hex) {
      parent.postMessage({ pluginMessage: { type: 'COPY_HEX', value: hex } }, '*');
      toast(`Copied ${hex}`);
    }

    function randomHex() {
      const n = Math.floor(Math.random() * 0xffffff);
      return '#' + n.toString(16).padStart(6, '0').toUpperCase();
    }

    function normalizeHex(h) {
      const s = h.trim();
      const m = s.match(/^#?([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/);
      if (!m) return null;
      const x = m[1];
      return '#' + (x.length === 3 ? x.split('').map(c => c + c).join('') : x).toUpperCase();
    }

    function rgbToHex(r,g,b){ const toHex=v=>v.toString(16).padStart(2,'0'); return '#' + toHex(r)+toHex(g)+toHex(b); }
    function hexToRgb(hex){ const n=parseInt(hex.slice(1),16); return {r:(n>>16)&255,g:(n>>8)&255,b:n&255}; }

    function rgbToHsl(r,g,b){
      r/=255;g/=255;b/=255;
      const max=Math.max(r,g,b),min=Math.min(r,g,b);
      let h,s,l=(max+min)/2;
      if(max===min){h=s=0;} else {
        const d=max-min;
        s=l>0.5?d/(2-max-min):d/(max+min);
        switch(max){case r:h=(g-b)/d+(g<b?6:0);break;case g:h=(b-r)/d+2;break;case b:h=(r-g)/d+4;break;}
        h/=6;
      }
      return {h:h*360,s:s*100,l:l*100};
    }

    function hslToRgb(h,s,l){
      h/=360;s/=100;l/=100;
      if(s===0){const v=Math.round(l*255);return{r:v,g:v,b:v};}
      const hue2rgb=(p,q,t)=>{if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p;};
      const q=l<0.5?l*(1+s):l+s-l*s; const p=2*l-q;
      const r=hue2rgb(p,q,h+1/3); const g=hue2rgb(p,q,h); const b=hue2rgb(p,q,h-1/3);
      return {r:Math.round(r*255),g:Math.round(g*255),b:Math.round(b*255)};
    }

    function generatePalette(hex,mode,n){
      const {h,s,l}=rgbToHsl(...Object.values(hexToRgb(hex)));
      const arr=[]; const push=(name,hh,ss=s,ll=l)=>{const {r,g,b}=hslToRgb(hh,ss,ll);arr.push({name,hex:rgbToHex(r,g,b)});};
      const labelIndex=(i)=>['50','100','200','300','400','500','600','700','800','900'][i]||`C${i+1}`;
      const start=Math.max(10,Math.min(95,l-40)); const end=Math.max(10,Math.min(95,l+40));
      for(let i=0;i<n;i++){ const ll=start+(end-start)*(i/(n-1)); push(labelIndex(i),h,s,ll); }
      return arr;
    }

    function toast(msg){
      const el=document.createElement('div'); el.className='toast'; el.textContent=msg;
      document.body.appendChild(el); setTimeout(()=>el.remove(),1300);
    }

    function generateGradient() {
      if (currentPalette.length < 2) return;
      const sample = currentPalette.slice(0, Math.min(4, currentPalette.length)).map(c => c.hex);
      const gradient = `linear-gradient(135deg, ${sample.join(', ')})`;
      gradientPreview.style.background = gradient;
      gradientCode.textContent = gradient + ';';
      hero.style.background = gradient;
      gradientSection.style.display = "block";
    }

    function render(){
      const hex=normalizeHex(seed.value)||'#6C5CE7';
      currentPalette=generatePalette(hex,mode.value,parseInt(steps.value,10));
      grid.innerHTML='';
      currentPalette.forEach(p=>{
        const el=document.createElement('div');
        el.className='swatch';
        el.innerHTML=`<div style='background:${p.hex};width:100%;height:100%;'></div><div class='info'>${p.hex}</div>`;
        el.addEventListener('click',()=>copyHex(p.hex));
        grid.appendChild(el);
      });
      generateGradient();
      parent.postMessage({ pluginMessage: { type: 'ADJUST_HEIGHT', count: currentPalette.length } }, '*');
    }

    render();
  </script>
</body>
</html>
